{"version":3,"file":"index.cjs.js","sources":["../src/bem.js","../src/index.js"],"sourcesContent":["export const BEM = (block) => (variants, contexts, options) => {\n  const template = require('lodash.template');\n  let data = { block };\n  let formatter = template(options.blockFormat);\n  let base = formatter(data);\n\n  base = (variants ? Object.entries(variants).reduce((target, [key, value]) => {\n    if (!value) {\n      return target;\n    }\n\n    data = { base, key, value };\n    formatter = value === true ? template(options.variantFormatTrue) : template(options.variantFormat);\n    target += formatter(data);\n\n    return target;\n  }, '') : base);\n\n  base = (contexts ? Object.entries(contexts).reduce((target, [key, value]) => {\n    if (!value) {\n      return target;\n    }\n\n    data = { base, key, value };\n    formatter = value === true ? template(options.contextFormatTrue) : template(options.contextFormat);\n    target += formatter(data);\n\n    return target;\n  }, '') : base);\n\n  return base;\n};\n","import postcss from 'postcss';\nimport { BEM } from './bem';\n\nconst DEFAULT_OPTIONS = {\n  component: 'component',\n  variant: 'variant',\n  context: 'context',\n  variantRegExp: /([\\w\\-]+)(?:\\[([\\w\\-]+)\\])?/,\n  contextRegExp: /([\\w\\-]+)(?:\\[([\\w\\-]+)\\])?/,\n  blockFormat: '.${block}',\n  variantFormat: '.${base}__${key}_${value}',\n  variantFormatTrue: '.${base}__${key}',\n  contextFormat: '${base}_${key}_${value}',\n  contextFormatTrue: '${base}_${key}'\n};\n\nexport default (options = DEFAULT_OPTIONS) => {\n  options = Object.assign({}, DEFAULT_OPTIONS, options);\n\n  return (root) => {\n    const process = (node) => {\n      if (node.nodes.length === 0) {\n        return node;\n      }\n\n      if (node.name === options.component) {\n        node.metadata = { bem: BEM(node.params), type: options.component };\n      }\n\n      let selector = '';\n\n      switch (node.metadata.type) {\n        case options.component:\n          selector = node.metadata.bem(null, null, options);\n          break;\n        case options.context:\n          let [, contextName, contextVal = true] = node.metadata.name.match(options.contextRegExp);\n\n          node.metadata.contexts = { [contextName]: contextVal };\n          if (node.parent.metadata.type === options.context) {\n            node.metadata.contexts = { ...node.parent.metadata.contexts, ...node.metadata.contexts };\n          }\n\n          selector = node.metadata.bem(node.parent.metadata.variants, node.metadata.contexts, options);\n          break;\n        case options.variant:\n          let [, variantName, variantVal = true] = node.metadata.name.match(options.variantRegExp);\n\n          node.metadata.variants = { [variantName]: variantVal };\n          if (node.parent.metadata.type === options.variant) {\n            node.metadata.variants = { ...node.parent.metadata.variants, ...node.metadata.variants };\n          }\n\n          selector = node.metadata.bem(node.metadata.variants, node.parent.metadata.contexts, options);\n          break;\n      }\n\n      const rule = postcss.rule({\n        raws: { semicolon: true },\n        selector: selector,\n        source: node.source,\n        metadata: node.metadata\n      });\n\n      node.walkDecls(decl => {\n        const declClone = postcss.decl({\n          raws: { before: '\\n  ', between: ': ' },\n          source: decl.source,\n          prop: decl.prop,\n          value: decl.value\n        });\n\n        decl.replaceWith(declClone);\n      });\n\n      rule.append(node.nodes);\n      node.remove();\n      root.append(rule);\n\n      rule.walkAtRules(child => {\n        if (![options.variant, options.context].includes(child.name)) {\n          return;\n        }\n\n        child.metadata = {\n          type: child.name,\n          name: child.params,\n          bem: rule.metadata.bem,\n        };\n\n        return process(child);\n      });\n    };\n\n    root.walkAtRules(options.component, process);\n  };\n}\nmodule.exports.postcss = true\n"],"names":[],"mappings":"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"}